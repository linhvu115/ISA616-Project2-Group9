---
title: "FSB Survey Data Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
#runtime: shiny
---

```{r setup, include=FALSE,echo=FALSE}
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning=FALSE)

#package intialization
if(require(pacman)==FALSE) install.packages("pacman")
pacman::p_load(tidyverse, #for data manipulation
               plotly, #for interactive plots
               flexdashboard, #to make a dashboard
               fontawesome, #for icons
               DT, #for better tables
               scales #for displaying numbers in currency format
               )

#read in data
data = readRDS("cleaned_FSB_survey_data.RDS")
```

# General Overview {data-orientation=columns}

An overall summary of our project
  
## row {data-width=600}

### The Question We Want to Answer

We want to know more about the macro placement and salary trends of Farmer School of Business Students by year and major. We are interested in seeing whether there are any common patterns that can be spotted from 2019 to 2021 in the dataset.

We have created two pages in our dashboard, each with insights into student placement information by year and major. These can be accessed through clicking on each tab.

Through this, we would be able to derive more insights into which year and major we should place more investment in respectively. This would allow us to devise a more effective management method for the growth and advancement of the Farmer School.

## row {data-height=600}

### Additional Insights

```{r,echo=FALSE}

```

# Placement by Year {data-orientation=columns}

## Column {data-width=500}

### Data Table of Placement by Year

```{r,echo=FALSE}
data1 = data %>%
  group_by(major1, year.x, survey_company) %>%
  summarize(count = n()) %>%
  arrange(major1, - count)

datatable(data1, rownames = F, extensions = 'Buttons',
          options = list(dom = 'Bfrtip',
                         buttons = c('copy','csv','excel')
                         ))
```

### Average Salary Placement by Year

```{r,echo=FALSE}
data2 = data %>%
  drop_na(survey_salary) %>%
  group_by(year.x) %>%
  summarize(avg = mean(survey_salary))

m = ggplot()+
  geom_col(aes(x = year.x, y = avg), fill = "#C8102E", data = data2)+
  xlab("Year")+
  ylab("Average Salary")+
  theme_bw()+
  theme(axis.title.x = element_text(margin=margin(r=12)),
        axis.title.y = element_text(margin=margin(r=12)))+
  coord_flip()

ggplotly(m)
```

## Column {data-width=600}

### Top 10 Survey Companies Salary's Placement

```{r,echo=FALSE}
data3 = data %>%
  drop_na(survey_salary) %>%
  group_by(survey_company, year.x) %>%
  summarize(avg = mean(survey_salary)) %>%
  arrange(desc(avg)) %>%
  head(10)

n = ggplot()+
  geom_col(aes(x = survey_company, y = avg), fill = "#C8102E", data = data3)+
  theme_bw()+
  facet_wrap(~ year.x)+
  theme(axis.title.x = element_blank(),
        axis.text.x= element_blank(),
        axis.ticks.x= element_blank(),
        axis.title.y = element_text(margin=margin(r=100)))+
  coord_flip()

ggplotly(n)
```


# Placement by Major {data-orientation=columns}

## Column {data-width=400}

### Data Table of Placement by Major

```{r,echo=FALSE}
data2 = data %>%
  group_by(major1) %>%
  summarize(
    student_count = n(),
    avg_salary = dollar(mean(survey_salary, na.rm = TRUE))
  ) %>%
  arrange(major1)

datatable(data2, rownames = F, extensions = 'Buttons',
          options = list(dom = 'Bfrtip',
                         buttons = c('copy','csv','excel')
                         ))
```

### Changes in Salary from 2019-2021 by Top 5 Major with Highest Average Salary

```{r,echo=FALSE}
# Select the top 5 majors with the highest average salary
major_5 <- data %>%
  group_by(major1) %>%
  summarize(Average_Salary = mean(survey_salary, na.rm = TRUE)) %>%
  top_n(5, Average_Salary) %>%
  pull(major1)

salary_5_changes <- data %>%
  group_by(major1, year.x) %>%
  summarize(Average_Salary = mean(survey_salary, na.rm = TRUE)) %>%
  filter(major1 %in% major_5)

# Create a line plot to visualize changes in salary by major from 2019 to 2021
p = ggplot(salary_5_changes, aes(x = year.x, y = Average_Salary, group = major1, color = major1)) +
  geom_line() +
  geom_point(size = 2) +
  labs(x = "Year",
       y = "Average Salary ($)",
       caption = "Data Source: FSB Survey Data") +
  theme_minimal()

ggplotly(p)
```


## Column {data-width=600}

### Average Salary by Majors

```{r,echo=FALSE}
p = data %>%
  group_by(major1) %>%
  summarize(avg_salary = mean(survey_salary, na.rm = TRUE)) %>%
  filter(!is.na(avg_salary) & avg_salary > 0) %>%
  arrange(desc(avg_salary)) %>%
  ggplot(aes(x = avg_salary, y = reorder(major1, -avg_salary))) +
  geom_bar(stat = "identity", fill = "dodgerblue3") +
  labs(x = "Average Salary ($)",
       y = "Major",
       caption = "Data Source: FSB Survey Data") +
  theme_minimal()

ggplotly(p)
```

